#include "DepthSearcher.h"
#include <cstdio>
#include <cstdlib>
#include <iostream>
#include <fstream>
#include <string>
#include <vector>


int main( int argc, char *argv[] ) {
   if( argc != 3 ) {
      std::cerr<<"Usage: "<<argv[0]<<" [per_amp.txt] [eigenvalues_near_source (.R file from SURF_DIS)]"<<std::endl;
      exit(-1);
   }

   /* read in per_amp data */
   std::vector< std::vector<float> > amplist;
   std::ifstream fin(argv[1]);
   if( ! fin ) {
      std::cerr<<"Cannot read from file "<<argv[1]<<std::endl;
      exit(0);
   }
   for(std::string line; std::getline(fin, line); ) {
      float ftmp[2];
      sscanf(line.c_str(), "%f %f", &ftmp[0], &ftmp[1]);
      std::vector<float> vftmp(ftmp, ftmp+2);
      amplist.push_back( vftmp );
   }
   fin.close();
   std::cout<<"Amplitude at "<<amplist.size()<<" periods read in."<<std::endl;

   /* search for depth */
   std::string radexe("/home/tianye/code/Programs/RadPattern/rad_pattern4_Rayl.dir/rad_pattern4_Rayl");
   DepthSearcher ds(amplist, argv[2], radexe.c_str());
   std::cout<<ds.Depth()<<std::endl;

   return 0;
}
