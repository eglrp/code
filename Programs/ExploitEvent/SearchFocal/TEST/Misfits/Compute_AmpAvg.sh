#!/bin/bash
if [ $# -lt 5 ]; then
   echo "Usage: "$0" [azi_misG file] [azi_misP file] [azi amp file] [outfile name] [per]"
   exit
fi
t0=-4
t1=-4
Sexe=/projects/yeti4009/code/Programs/Smoothing/Fast_Smoothing_curve
f_misG=$1
f_misP=$2
f_amp=$3
bin_azi=10
for file in $f_misG $f_misP $f_amp; do
   awk -v bin=$bin_azi '{print $1,$2; if($1<=bin*2.5){print $1+360,$2}}' $file > filetmp
   $Sexe filetmp $bin_azi
   awk '{azi=$1;if(azi>=360){azi-=360.}printf "%.1f %f %f %d\n",azi,$2,$3,$4}' filetmp_sm | sort -g > $file'_sm'
   rm -f filetmp filetmp_sm
done

per=$5
echo -e $f_misG'_sm\n'$f_misP'_sm\n'$f_amp'_sm' > file.list
/projects/yeti4009/code/Programs/mini_tools/File_Combiner file.list 1 outtemp
awk -v t0=$t0 -v t1=$t1 '$4>10&&$8>10&&$12>10{print $1"   "$2+t0,$3"   "$6+t1,$7"   "$10,$11}' outtemp > $4
echo $4
#paste $f_misG'_sm' $f_misP'_sm' $f_amp'_sm' | awk 'NF==6' | awk -v per=$per '{print $1,$2,$4,$6}' > $4
#rm -f $f_misG'_sm' $f_misP'_sm' $f_amp'_sm' file.list outtemp
